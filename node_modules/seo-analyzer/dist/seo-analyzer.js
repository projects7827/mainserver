!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("fs"),require("path"),require("jsdom"),require("cli-progress"),require("colors"),require("cfonts"),require("axios"),require("sitemap-stream-parser"),require("express"),require("next")):"function"==typeof define&&define.amd?define(["fs","path","jsdom","cli-progress","colors","cfonts","axios","sitemap-stream-parser","express","next"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["seo-analyzer"]=t(e.fs,e.path,e.jsdom,e.cliProgress,e._colors,e.CFonts,e.axios,e.sitemaps,e.express,e.next)}(this,(function(e,t,r,s,n,o,i,a,l,h){"use strict";function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var c=u(e),g=u(t),p=u(s),f=u(n),d=u(o),m=u(i),y=u(a),_=u(l),w=u(h);const F={titleLengthRule:function(e,t){return new Promise(r=>{const s=e.window.document.querySelector("title");s||r("This HTML without <title> tag");const n=s.length;n<t.min&&r(`<title> too short(${n}). The minimum length should be ${t.min} characters.`),n>t.max&&r(`<title> too long(${n}). The maximum length should be ${t.max} characters.`),r(null)})},imgTagWithAltAttributeRule:function(e){return new Promise(t=>{let r=0,s=0;const n=[];e.window.document.querySelectorAll("img").forEach(e=>{e.alt||r++,e.src||s++}),s>0&&n.push(`There are ${s} <img> tag without src attribute`),r>0&&n.push(`There are ${r} <img> tag without alt attribute`),(s||r)&&t(n),t(null)})},aTagWithRelAttributeRule:function(e){return new Promise(t=>{let r=0;e.window.document.querySelectorAll("a").forEach(e=>{e.rel||r++}),r>0&&t(`There are ${r} <a> tag without rel attribute`),t(null)})},canonicalLinkRule:function(e){return new Promise(t=>{const r=e.window.document.querySelector('head > link[rel="canonical"]');r||t('This HTML without <link rel="canonical" href="..."> link'),r&&!r.href&&t("The canonical link without href attribute"),r&&"/"!==r.href.substr(-1)&&t("The href attribute does not have a slash at the end of the link."),t(null)})},metaBaseRule:function(e,t={list:[]}){return new Promise(r=>{const s=[];t&&t.names&&t.names.length&&t.names.forEach(t=>{const r=e.window.document.querySelector(`head > meta[name="${t}"]`);r?r.content||s.push(`The content attribute for the <meta name="${t}" content=""> tag is empty`):s.push(`This HTML without <meta name="${t}"> tag`)}),r(s)})},metaSocialRule:function(e,t={properties:[]}){return new Promise(r=>{const s=[];t&&t.properties&&t.properties.length&&t.properties.forEach(t=>{const r=e.window.document.querySelector(`head > meta[property="${t}"]`);r?r.content||s.push(`The content attribute for the <meta property="${t}" content=""> tag is empty`):s.push(`This HTML without <meta property="${t}"> tag`)}),r(s)})}};class T{result(e){this._logResult(e)}error(e,t){this._logError(e),t&&process.exit(1)}success(e){this._logSuccess(e)}info(e){this._logInfo(e)}printTextToConsole(e){const t=e.replace(" ","|");d.default.say(t,{font:"block",align:"left",colors:["system"],background:"transparent",letterSpacing:1,lineHeight:1,space:!0,maxLength:"0",gradient:!1,independentGradient:!1,transitionGradient:!1,env:"node"})}_logResult(e){if(!e.some(e=>e.report.length))return this._logSuccess("\nðŸ‘ SEO defects were not detected.\n");this._logInfo("\nðŸš€  Report of errors");for(const t of e)this._logInfo("\nFile: "+t.source.trim()),this._logError(""+t.report.join("\n"));return this._logSuccess("\n-------- ðŸš€ Finished! --------\nThanks for using Seo Analyzer!\n"),process.exit(1)}_logError(e){console.error(""+f.default.red(e))}_logInfo(e){console.log(""+f.default.yellow(e))}_logSuccess(e){console.log(""+f.default.green(e))}}class b{constructor(){this.consoleProgressBar=new p.default.Bar({format:"Processing... |"+f.default.green("{bar}")+"| {percentage}% || {value}/{total} Pages",barCompleteChar:"â–ˆ",barIncompleteChar:"â–‘",hideCursor:!0}),this.logger=new T,this.inputUrl="",this.ignoreUrls=""}async run(e,t,r){this.inputUrl="http://localhost:"+e,this.ignoreUrls=t;const s=await this._getLinksFromSitemap(r);return await this._getHtmlDomFromLinks(s)}_getLinksFromSitemap(e){return this.logger.info(`ðŸš€  Get sitemap from ${this.inputUrl}\n`),new Promise(t=>{const r=`${this.inputUrl}/${e}`,s=[];y.default.parseSitemaps(r,e=>{const t=e.replace(/^.*\/\/[^/]+/,"");-1===this.ignoreUrls.indexOf(t)&&s.push(this._formatLink(e))},e=>{e?this.logger.error("âŒ  Sitemap not found\n",1):s.length?(this.logger.success("âœ…  Done\n"),t(s)):this.logger.error("âŒ  Links not found\n",1)})})}_formatLink(e){return e.replace(/^.*\/\/[^/]+/,this.inputUrl)}sleep(e){return new Promise(t=>setTimeout(t,e))}async _getHtmlDomFromLinks(e){const t=[],r=[];this.logger.info("ðŸš€  Parsing HTML\n"),this.consoleProgressBar.start(e.length,0);for(const s of e)r.push(m.default.get(s).then(e=>{e&&200===e.status&&t.push({source:s,text:e.data})}).catch(e=>{const t=e&&e.response&&e.response.status||500;console.log(`Error: ${e} - ${s}`),console.log(`\n${f.default.yellow("==>")} ${f.default.white(s)} ${f.default.red(t)}`)}).finally(()=>{this.consoleProgressBar.increment()})),await this.sleep(500);return Promise.all(r).then(()=>(this.consoleProgressBar.stop(),t))}}class x{constructor(){this.logger=new T,this.scraper=new b,this.consoleProgressBar=new p.default.Bar({format:"Processing... |"+f.default.green("{bar}")+"| {percentage}% || {value}/{total} Folders",barCompleteChar:"â–ˆ",barIncompleteChar:"â–‘",hideCursor:!0}),this.badType='The inputFiles function takes an array only ["index.html", "...", "..."]',this.emptyList='You need to pass an array to the inputFiles function ["index.html", "...", "..."]',this.ignoreFolders=[],this.ignoreFiles=[]}async files(e=[],t=[]){Array.isArray(e)&&e.length||this.logger.error('âŒ  The "inputFiles" method expects an array of files.\n',!0),Array.isArray(t)||this.logger.error('âŒ  The "ignoreFiles" method expects an array of ignore files.\n',!0),this.logger.info("\nðŸš€  Parsing files\n"),0===e.length&&this.logger.error(this.emptyList),Array.isArray(e)||this.logger.error(this.badType),this.ignoreFiles=t;const r=await this._getHtml(e);return await this._getDom(r)}async folders(e=[],t=[],r=[]){Array.isArray(e)&&e.length||this.logger.error('âŒ  The "inputFolders" method expects an array of folders.\n',!0),Array.isArray(t)||this.logger.error('âŒ  The "ignoreFolders" method expects an array of ignore folders.\n',!0),this.logger.info("ðŸš€  Parsing folders\n"),this.consoleProgressBar.start(e.length,0),this.ignoreFolders=t,this.ignoreFiles=r;const s=await this._getFilesFromFolders(e);return await this.files(s,r)}async spa(e,t=[],r){const s=await this.scraper.run(e,t,r);return await this._getDom(s)}async _getFilesFromFolders(e=[]){const t=[];for(const r of e){const e=await this._getFilesFromFolder(r);this.consoleProgressBar.increment(),t.push(...e)}return this.consoleProgressBar.stop(),t.length||this.logger.error("\nâŒ  No files found.\n",!0),t}_getFilesFromFolder(e=[]){try{const t=c.default.readdirSync(e).map(t=>g.default.join(e,t)),r=t.filter(e=>c.default.statSync(e).isFile()&&".html"===g.default.extname(e)),s=t.filter(e=>!r.includes(e)&&c.default.statSync(e).isDirectory()).filter(e=>!this.ignoreFolders.includes(e)).reduce((e,t)=>e.concat(this._getFilesFromFolder(t)),[]);return[...r,...s]}catch(t){return this.logger.error(`\n\nâŒ Folder "${e}" not found\n`),[]}}_getHtml(e){const t=[],r=new p.default.Bar({format:"Processing... |"+f.default.green("{bar}")+"| {percentage}% || {value}/{total} Sources",barCompleteChar:"â–ˆ",barIncompleteChar:"â–‘",hideCursor:!0});return r.start(e.length,0),e.forEach(e=>{if(!this.ignoreFiles.includes(e))try{const s=c.default.readFileSync(e,"utf8");t.push({source:e,text:s}),r.increment()}catch(t){r.increment(),this.logger.error(`\n\nFile "${e}" not found\n`)}}),r.stop(),t.length||this.logger.error("\nâŒ  No files found.\n",!0),t}_getDom(e){const t=[],s=new p.default.Bar({format:"Handling html |"+f.default.green("{bar}")+"| {percentage}% || {value}/{total} Sources",barCompleteChar:"â–ˆ",barIncompleteChar:"â–‘",hideCursor:!0});this.logger.info("\nðŸš€  Get DOM from HTML\n"),s.start(e.length,0);const n=new r.VirtualConsole;return e.forEach(e=>{let o=new r.JSDOM(e.text,{virtualConsole:n});t.push({source:e.source,dom:o}),s.increment()}),s.stop(),t}}class S{constructor(){this.consoleProgressBar=new p.default.Bar({format:"Ranning rules |"+f.default.green("{bar}")+"| {percentage}% || {value}/{total} Rules",barCompleteChar:"â–ˆ",barIncompleteChar:"â–‘",hideCursor:!0}),this.badType='The inputFiles function takes an array only ["index.html", "...", "..."]',this.emptyList='You need to pass an array to the inputFiles function ["index.html", "...", "..."]'}async run(e,t){0===e.length&&this.logger.error(this.emptyList),Array.isArray(e)||this.logger.error(this.badType);return await this._startAnalyzer(e,t)}async _startAnalyzer(e,t){const r=[];for(const s of e){console.log(`\n${f.default.blue("==>")} Analysis ${f.default.white(s.source)}`);const e=await this._analyzeDOM(s.dom,t);e&&e.length&&r.push({source:s.source,report:e})}return r}async _analyzeDOM(e,t){const r=[];this.consoleProgressBar.start(t.length,0);for(const s of t){let t=null;try{t=await s.rule(e,s.options)}catch(e){t=e}Array.isArray(t)?r.push(...t):t&&r.push(t),this.consoleProgressBar.increment()}return this.consoleProgressBar.stop(),r}}class P{constructor(){this.analyzer=new S}async object(e,t){return await this.analyzer.run(e,t)}async json(e,t){const r=await this.analyzer.run(e,t);return JSON.stringify(r,null,2)}}class C{constructor(){this.logger=new T,this._input=new x,this.port=parseInt(process.env.PORT,10)||3e3,this.app=w.default({dev:!1}),this.handle=this.app.getRequestHandler(),this.status={}}run(){return new Promise((e,t)=>{this.app.prepare().then(()=>{const t=_.default();t.all("*",(e,t)=>this.handle(e,t)),t.listen(this.port,t=>{if(t)throw t;this.logger.info(`ðŸš€  Ready on http://localhost:${this.port}\n`),e({status:"Active"})})}).catch(e=>{this.logger.error("âŒ  Error Starting Server\n"),console.error(e.stack),process.exit(1),t(new Error("Error Starting Server"))})})}async inputSSR(e,t=[],r){this.port=e,this.status=await this.run();return this._input.spa(this.port,t,r)}}const A=_.default(),$=new T;return class{constructor(){return this._logger=new T,this._input=new x,this._output=new P,this._nextServer=new C,this._inputData=[],this._defaultRules=F,this._rules=[],this._ignoreFolders=[],this._ignoreFiles=[],this._ignoreUrls=[],this}ignoreFiles(e){return this._ignoreFiles=e,this}ignoreFolders(e){return this._ignoreFolders=e,this}ignoreUrls(e){return this._ignoreUrls=e,this}inputFiles(e){return 0!==this._inputData.length||(this._logger.printTextToConsole("SEO Analyzer"),this._inputData=this._input.files(e,this._ignoreFiles)),this}inputFolders(e){return 0!==this._inputData.length||(this._logger.printTextToConsole("SEO Analyzer"),this._inputData=this._input.folders(e,this._ignoreFolders,this._ignoreFiles)),this}inputSpaFolder(e,t="sitemap.xml",r=9999){return this._inputData?(this._logger.printTextToConsole("SEO Analyzer"),function(e,t){A.use(_.default.static(e)),A.get("/",(e,t)=>{t.sendFile(g.default.join(__dirname,"/index.html"))}),A.listen(t),$.info(`ðŸš€  Server started on port ${t}\n`),$.success("âœ…  Done\n")}(e,r),this._inputData=this._input.spa(r,this._ignoreUrls,t),this):this}inputNextJs(e="sitemap.xml",t=3e3){return this._inputData?(this._logger.printTextToConsole("SEO Analyzer"),this._inputData=this._nextServer.inputSSR(t,this._ignoreUrls,e),this):this}addRule(e,t={}){return"string"==typeof e?e in F?this._rules.push({rule:F[e],options:t}):this._logger.error(`\n\nâŒ  Rule "${e}" not found\n`,1):"function"==typeof e?this._rules.push({rule:e,options:t}):this._logger.error("\n\nâŒ  Rule must be a function or a string\n",1),this}outputConsole(){return(async()=>{const e=await this._output.object(await this._inputData,this._rules);this._logger.result(e)})(),this}outputJson(e){return(async()=>{const t=await this._output.json(await this._inputData,this._rules);e(t)})(),this}outputObject(e){return(async()=>{const t=await this._output.object(await this._inputData,this._rules);e(t)})(),this}}}));
//# sourceMappingURL=seo-analyzer.js.map
